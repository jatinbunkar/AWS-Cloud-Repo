# Using S3 Bucket Policies and Conditions to Restrict Specific Permissions

### Description

Anonymous users and accounts are restricted by default from accessing S3 unless they are given access through
Simple Storage Serviceâ€™s (S3) bucket policy. Bucket policies are based around the use of JSON (JavaScript Object
Notation) files. AWS makes it relatively easy to set basic permissions on its S3 buckets through the AWS Policy
Generator that presents with a Policy JSON Document that user can copy and paste to achieve this lab exercise.
The objective of this lab is to create a bucket policy to restrict specific IP address and to deny any uploaded object
that does not have server-side encryption.

### Architecture Diagram

The diagram below displays a visual representation of the application architecture:

<p align="center">
  <img src="https://github.com/jatinbunkar/AWS-Clouds/blob/0a22cd068ace1a6760771de0e8b737ca65058fdd/Screenshots/lab11-s1.png" alt="Screenshot of lab11-s1">
</p>

---

### Labs Steps:

Follow the steps outlined below to achieve the objective of this lab exercise:

1. Navigate to S3 service and create a S3 bucket and inside a bucket, choose bucket policy under
Permissions section.

2. Attach a policy directly or generate it by using a Policy Generator. For this lab exercise, use Policy
Generator.

3. Select policy type as S3 bucket policy. Select Effect as Allow to reject permissions and Principal as *
(The Principal dictates the user, account or service that policy applies to. An asterisk is a wildcard to match
all.)

4. Service by default stays Amazon S3. Scroll through the actions available and choose s3:GetObject and
mention the bucket arn.

5. Click Add Statement and then Generate Policy when ready to proceed. It generates a bucket policy which
will be used for the bucket created.

6. Copy and paste the bucket policy in respective bucket created.
7. 
Note: Error message displays if user tries to access objects in the bucket as the Policy denies get objects
permission for the bucket.

8. Now use another policy which allows to upload objects only if they are encrypted.

9. Create a new policy, follow the same steps (from steps 5 to 10) with a few changes, select actions as
PutObject and under conditions choose Condition as StringNotEquals and Key as s3:x-amz-server-
side-encryption and under Value enter AES256.

10. Error message displays if the user tries to upload an object inside the bucket.

11. Try uploading the file again with encryption enabled. Click Next and navigate to Set properties screen of
the wizard.

12. In the Encryption section, click Amazon S3 master-key radio button to enable encryption and under
review page encryption is enabled.

13. Click Upload. This time the file is uploaded to S3 bucket, because the bucket policy was not violated.


### Supporting References

Refer the below link for additional information:
- [AWS Documentation: S3 Poilcy](https://docs.aws.amazon.com/AmazonS3/latest/dev/amazon-s3-policy-keys.html)


