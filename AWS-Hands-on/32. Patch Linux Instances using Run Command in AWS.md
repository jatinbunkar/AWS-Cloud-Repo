# **Patch Linux Instances using Run Command in AWS**

## **Description**

In this hands-on lab, you will solve a real-world scenario where we will patch our Linux servers using the **Run Command** feature in AWS Systems Manager Service.  
**Run Command** enables you to automate common administrative tasks and perform ad hoc configuration changes at scale.

---
### **Architecture Diagram**
The diagram below displays a visual representation of the application architecture:

<img width="698" alt="image" src="https://github.com/user-attachments/assets/4f95850b-d939-4c84-83ef-78f8b1cbc131">

## **Lab Steps**

Follow the steps outlined below to achieve the objective of this lab exercise.

### **Step 1: Launch an EC2 Instance**
1. Log in to the AWS Console and navigate to the **EC2** service.
2. In the EC2 dashboard, click on **Launch Instance**.
3. In **Step 1: Choose an Amazon Machine Image (AMI)**, select **Amazon Linux 2 AMI (HVM)**.
4. In **Step 2: Choose Instance Type**, select **t2.micro**, and click **Next**.
5. In **Step 3: Configure Instance Details**, under **IAM Role**, choose **EC2-Role**, and click **Review and Launch**.
6. (Optional) Create a key pair if you plan to SSH into your instance via PuTTY. If you prefer using the **Session Manager** service, choose the option **Proceed without a key pair**.

<img width="910" alt="image" src="https://github.com/user-attachments/assets/ac8c5a33-4f30-4ced-ae8f-3af1ef3df478">


### **Step 2: Ensure the Instance is Running**
7. In the **Instances Dashboard**, confirm that your instance is in a **running** state.



### **Step 3: Create an S3 Bucket**
8. Navigate to the **S3** service.
9. Create a new bucket, ensuring that it adheres to the S3 bucket naming rules.

<img width="979" alt="image" src="https://github.com/user-attachments/assets/1824dcc8-1596-48e7-baf3-46e9aeef3fb3">



### **Step 4: Use Systems Manager Run Command**
10. Navigate to the **Systems Manager** service.
11. In the left-hand pane, under **Instances and Nodes**, select **Run Command**.
12. Click on **Run Command** and search for the document **AWS-RunPatchBaseline**, then select it.

<img width="1164" alt="image" src="https://github.com/user-attachments/assets/7b52547a-0576-4b8b-85bf-d80a403b38f6">


### **Step 5: Configure Command Parameters**
13. Scroll down to the **Command Parameters** section and set the **Operation** to **Install**.

<img width="949" alt="image" src="https://github.com/user-attachments/assets/88d00d3c-d930-4ebf-b2c8-e3eda0dd954b">

### **Step 6: Select Targets**
14. Under the **Targets** section, choose how to select instances:
    - For this lab, select **Choose instances manually** and select the instance you created earlier.
    - In real-world scenarios, you may have a greater number of instances categorized under tags (e.g., dev, prod) or resource groups. Use those options for more efficient targeting.

<img width="1152" alt="image" src="https://github.com/user-attachments/assets/f9a730c6-fc80-4984-93c2-f4b84b7e984c">


### **Step 7: Enable Output Logging**
15. Under **Output Options**, check the option **Enable writing to an S3 Bucket**, then select the S3 bucket you created in Step 3.

### **Step 8: Run the Command**
16. Click **Run** to execute the command.  
    - Monitor the command status until it changes to **Success**.

<img width="1152" alt="image" src="https://github.com/user-attachments/assets/0c4ccac8-7763-426f-8c71-edb6ee5c83f8">


### **Step 9: Verify the Results**
17. Once the status shows **Success**, your server has been patched successfully.
18. Navigate to the S3 bucket you created earlier to view the log file for details of the operation.

<img width="1160" alt="image" src="https://github.com/user-attachments/assets/a9598fae-5380-4477-9cf6-7b27921ea091">

<img width="1185" alt="image" src="https://github.com/user-attachments/assets/82947c03-a2ec-4f29-b0a2-5f6d3fb110b5">

---

## **Outcome**
You have successfully patched a Linux instance using the **Run Command** feature in AWS Systems Manager. The patching process logs have been saved in your S3 bucket for review.

---

## **Supporting References**
- [AWS Systems Manager Run Command Documentation](https://docs.aws.amazon.com/systems-manager/latest/userguide/execute-remote-commands.html)
- [AWS-RunPatchBaseline Document](https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-manager-ssm-documents.html#aws-runpatchbaseline)
