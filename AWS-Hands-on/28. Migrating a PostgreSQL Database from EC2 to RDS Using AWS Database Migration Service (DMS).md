# **Migrating a PostgreSQL Database from EC2 to RDS Using AWS Database Migration Service (DMS)**


## 1. Set Up the Source Database on EC2

### 1.1 Launch an EC2 Instance
- Go to the EC2 Console and launch an instance (e.g., Amazon Linux or Ubuntu).
- Configure the security group to allow access on PostgreSQL’s default port 5432.
  - Example: `Inbound rule: TCP port 5432, source: your IP`.
 
<img width="1209" alt="image" src="https://github.com/user-attachments/assets/77d551da-6ea1-4316-86a9-80a0bcc94090">


### 1.2 Install PostgreSQL on EC2
- SSH into the EC2 instance.
- Install PostgreSQL:
  - **For Amazon Linux**: `sudo yum install postgresql -y`
  - **For Ubuntu**: `sudo apt update && sudo apt install postgresql -y`

### 1.3 Set Up PostgreSQL Database on EC2
- Start the PostgreSQL service (if it’s not already running).
- Switch to the PostgreSQL user:
  ```bash
  sudo -i -u postgres
  ```
- Create a new database and table:

```sql
psql
CREATE DATABASE sourcedb;
\c sourcedb
CREATE TABLE employees (id SERIAL PRIMARY KEY, name VARCHAR(50), position VARCHAR(50));
INSERT INTO employees (name, position) VALUES ('Alice', 'Developer'), ('Bob', 'Manager');
```
- Exit `psql` by typing ``\q`.

### 1.4 Allow External Connections to PostgreSQL:
- Edit the PostgreSQL config file at `/var/lib/pgsql/data/postgresql.conf` or `/etc/postgresql/XX/main/postgresql.conf`.
- Set `listen_addresses` to `'*'` to allow connections from any IP.
- Edit the `pg_hba.conf` file (located in the same directory) to add:

```text
host    all             all             0.0.0.0/0               md5
```

- Restart PostgreSQL:

```sql
sudo service postgresql restart
```
## 2. Configure the Target Database (RDS PostgreSQL)
1. Create a PostgreSQL RDS Instance:
    - Go to the RDS Console, select Create database.
    - Choose PostgreSQL, configure DB instance settings, and create the database.
    - Make sure it’s in the same VPC as the DMS replication instance.
2. Configure Security Group for RDS:
    - Add an inbound rule to the RDS security group allowing connections on port 5432 from the EC2 instance and DMS replication instance.
    - Retrieve the endpoint URL of the RDS instance; you’ll need this for DMS configuration.

##  3: Set Up AWS Database Migration Service (DMS)
1. Create a DMS Replication Instance:
    - In the DMS Console, select Create replication instance.
    - Ensure the instance is in the same VPC and has access to both the EC2 source and RDS target.
